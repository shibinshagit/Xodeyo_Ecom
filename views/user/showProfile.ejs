<%- include('../layouts/head.ejs') %>
<body>
    <%- include('../layouts/header.ejs') %>  

    <main class="main">
        <section class="pt-150 pb-150">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 m-auto">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="dashboard-menu">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                                                href="#dashboard" role="tab" aria-controls="dashboard"
                                                aria-selected="false">Profile</a>
                                        </li>
                                       
                                        <li class="nav-item">
                                            <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders"
                                                role="tab" aria-controls="orders" aria-selected="false">Orders</a>
                                        </li>
                                    
                                        <li class="nav-item">
                                            <a class="nav-link" id="coupon-tab" data-bs-toggle="tab" href="#coupon"
                                                role="tab" aria-controls="coupon" aria-selected="true">coupon</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address"
                                                role="tab" aria-controls="address" aria-selected="true">Edit Profile</a>
                                        </li>

                                        <li class="nav-item">
                                            <a class="nav-link" href="/logout" style="color: red;"><i
                                                    class="fi-rs-sign-out mr-10"></i>Logout</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            
                            <div class="col-md-9">
                                <div class="tab-content dashboard-content">
                                    <div class="tab-pane fade active show" id="dashboard" role="tabpanel"
                                        aria-labelledby="dashboard-tab">
                                        <p>Hello, <strong>
                                                <%=userData.name%>
                                            </strong>! Welcome back</p>

                                            <div class="row">


                                                <div class="col-lg-4">
                                                    <div class="card mb-4 custom-card">
                                                        <div class="card-body text-center align-items-center">
                                                         
                                                                <img src="adminAssets/imgs/userImages/<%= userData.image %>" alt="avatar" class="rounded-circle img-fluid" style="width: 50px;height: 50px;">
                                                           
                                                            <p class="text-brand">
                                                                <%= userData.name %>
                                                            </p>
                                                            <hr>
                                                            <p class="mb-0 text-brand">
                                                                <%= userData.email %>
                                                            </p>
                                                                    <hr>
                                                                   
                                                                        
                                                              
                                                                            <p class="mb-0 text-brand">
                                                                                <%= userData.phone %>
                                                                            </p>
                                                                 
                                                                        <hr> 
                                                                       
                                                                            <i style="font-size: 40px;"
                                                                                class="fa-solid fa-wallet  mt-3  text-warning"> 
                                                                                ₹   <%= userData.walletBalance %>
                                                                            </i>
                                                                           
                                                                           
                                                                            
                                                                  
                                                                        <hr> 
                                                            <!-- Referral Code Section -->
                                                            <div id="referralCodeSection" class="referral-code-section">
                                                                <p>Your Referral Code: <span id="referralCode" onclick="copyReferralCodeToClipboard()"><%= userData.referralCode %></span></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md">
                                                    <article class="box mb-3 bg-light p-4 text-center">
                                                        <i style="font-size: 40px;"
                                                            class="fa-solid fa-cart-shopping mt-3 text-success"></i>
                                                        <h6 class="mt-2">Orders</h6>
                                                        <h4>
                                                            <%= totalOrders %>
                                                        </h4>
                                                        <small class="text-muted " style="width:70%">Total Orders
                                                        </small>
                                                    </article>
                                                </div> <!-- col.// -->
                                                <div class="col-md">
                                                    <article class="box mb-3 bg-light p-4 text-center">
                                                        <i style="font-size: 40px;"
                                                            class="fa-solid fa-gift  mt-3  text-success"></i>
                                                        <h6 class="mt-2">Products</h6>
                                                        <h4>
                                                            <%= totalUniqueProducts %>
                                                        </h4>
       
                                                        <small class="text-muted" style="width:70%">Total ordered</small>
                                                    </article>
                                                </div> <!-- col.// -->
                                                <div class="col-md">
                                                    <article class="box mb-3 bg-light p-4 text-center">
                                                        <i style="font-size: 40px;"
                                                            class="fa-solid fa-money-bill  mt-3  text-success"></i>
                                                        <h6 class="mt-2">Total spent</h6>
                                                        <h4>
                                                            <%= totalSpending %>
                                                        </h4>
                                                        <small class="text-muted" style="width:70%">Total Spendings
                                                        </small>
                                                    </article>
                                                </div> <!-- col.// -->
                                               
                                                
                                               
                                            <style>    .custom-card {
                                                    border: 1px solid #e0e0e0;
                                                    border-radius: 10px;
                                                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                                                }
                                                
                                                .avatar-container {
                                                    margin-bottom: 20px;
                                                }
                                                
                                                .referral-code-section {
                                                    background-color: #f8f9fa;
                                                    padding: 15px;
                                                    border-radius: 5px;
                                                }
                                                
                                                #referralCode {
                                                    cursor: pointer;
                                                    color: #007bff;
                                                    font-weight: bold;
                                                }
                                            </style>                                                                                        
                                                
                                                
                                              
                                                    
    
    
                                               
                                           
    
                                                
                                            </div>




                                    </div>

                                    
                                    
                                    <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Your Orders</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th class="align-middle" scope="col">Date</th>
                                                                <th class="align-middle" scope="col">Total</th>
                                                                <th style="width: 150px;" class="align-middle"
                                                                    scope="col">Order Status</th>
                                                                <th class="align-middle" scope="col">Payment Method</th>
                                                               
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <% orderData.forEach(function(order) { %>

                                                                <tr  onclick="window.location.href='/userorderdetails?id=<%= order._id.toString() %>'">
                                                                    <td>
                                                                        <%= order.orderDate.toDateString() %>
                                                                    </td>
                                                                    <td>
                                                                        ₹ <%= order.totalAmount %>
                                                                    </td>
                                                                    <td>
                                                                        <% if (order.status==='Pending' ) { %>
                                                                            <span class="text-warning">
                                                                                <%= order.status %>
                                                                            </span>
                                                                            <% } else if
                                                                                (order.status==='Order Confirmed' ) { %>
                                                                                <span class="text-warning">
                                                                                    <%= order.status %>
                                                                                </span>
                                                                                <% } else if (order.status==='Shipped' )
                                                                                    { %>
                                                                                    <span class="text-dark">
                                                                                        <%= order.status %>
                                                                                    </span>
                                                                                    <% } else if
                                                                                        (order.status==='Out For Delivery'
                                                                                        ) { %>
                                                                                        <span class="text-dark">
                                                                                            <%= order.status %>
                                                                                        </span>
                                                                                        <% } else if
                                                                                            (order.status==='Delivered'
                                                                                            ) { %>
                                                                                            <span class="text-success">
                                                                                                <%= order.status %>
                                                                                            </span>
                                                                                            <% } else { %>
                                                                                                <span
                                                                                                    class="text-danger">
                                                                                                    <%= order.status %>
                                                                                                </span>
                                                                                                <% } %>



                                                                    </td>
                                                                    <td>
                                                                        <i
                                                                            class="material-icons md-payment font-xxl text-muted mr-5"></i>
                                                                        <%= order.paymentMethod %>
                                                                    </td>


                                                                   

                                                                </tr>
                                                                <% }); %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane fade" id="coupon" role="tabpanel"
                                        aria-labelledby="coupon-tab">
                                        <div class="col-md-8 col-lg-8">
                                            <div class="tab-content">
                
                
                
                                               
<div id="tab-account" aria-labelledby="tab-account-link">
    <div class="row">
        <% if (coupon.length > 0) { for (let i = 0; i < coupon.length; i++) { %>
            <div class="col-lg-4">
                <div class="d-flex justify-content-center couponContainer container">
                    <div class="d-flex couponCard card text-center">
                        <h1>
                            <% if (coupon[i].type == 'percentage') { %>
                                <%= coupon[i].discount %>% <% } else { %>₹ <%=
                                coupon[i].discount %>
                                <%}%>
                        </h1><span class="d-block">Discount</span>
                        <span class="d-block text-muted" style="font-size: medium;">Expires at:- <br>
                            <%= new Date(coupon[i].expiry).toLocaleDateString() %>
                        </span>
                        <% if (coupon[i].usersUsed.includes(User)) { %>
                            <p>Coupon Redeemed</p>
                        <% } else { %>
                            <div class="mt-4" style="margin-bottom: 20px;">
                                <small>With Code : <%= coupon[i].code %></small>
                            </div>
                            <button class="copy-coupon-btn btn btn-outline-2 "
                                    data-coupon="<%= coupon[i].code %>"> Copy
                            </button>
                        <% } %>
                    </div>
                </div>
            </div>
        <% } } else { %>
            <div class="col-6 col-md-4 col-xl-3">
                <p>No Coupon Found </p>
            </div>
        <% } %>
    </div>
</div>



<style>
    body {
        font-family: 'Arial', sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 20px;
    }

    .couponContainer {
        width: 300px;
        margin: 20px;
    }

    .couponCard {
        background-color: #85FFBD;
background-image: linear-gradient(45deg, #85FFBD 0%, #FFFB7D 100%);




        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        transition: transform 0.3s ease-in-out;
    }

    .couponCard:hover {
        transform: scale(1.05);
    }

    h1 {
        color: #000000;
        font-size: 2.5em;
        margin: 0;
    }

    span {
        display: block;
        margin-top: 10px;
    }

    .text-muted {
        font-size: medium;
    }

    p {
        color: #dc3545;
        margin-top: 10px;
        font-weight: bold;
    }

    .mt-4 {
        margin-top: 1.5rem;
    }

    .copy-coupon-btn {
        background-color: #000000;
        color: #ffffff;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease-in-out;
    }

    .copy-coupon-btn:hover {
        background-color: #218838;
    }
</style>
                
                                                <script>
                                                    // Add event listener to copy coupon code
                                                    document.querySelectorAll('.copy-coupon-btn').forEach(function (button) {
                                                        button.addEventListener('click', function () {
                                                            const couponCode = this.dataset.coupon;
                                                            copyToClipboard(couponCode);
                                                        });
                                                    });
                
                                                    // Function to copy text to clipboard
                                                    function copyToClipboard(text) {
                                                        navigator.clipboard.writeText(text).then(function () {
                                                            Swal.fire({
                                                                title: 'Copied',
                                                                text: 'Coupon code copied',
                                                                background: '#ffffff', // Set the background color to white
                                                                customClass: {
                                                                    popup: 'white-background', // Add a custom class for additional styling
                                                                },
                                                                icon: 'success',
                                                            });
                                                        }).catch(function (err) {
                                                            console.error('Unable to copy to clipboard', err);
                                                        });
                                                    }
                                                </script>
                
                
                                            </div>
                                        </div><!-- End .col-lg-9 -->

                                    </div>

                                    <div class="tab-pane fade" id="address" role="tabpanel"
                                        aria-labelledby="address-tab">
                                        <div class="row">
                                       


                                                <div class="col-lg-4">
                                                    <div class="card mb-4 custom-card">
                                                        <div class="card-body text-center align-items-center">
                                                         
                                                            <div class="profile-picture-container">
                                                                <img src="adminAssets/imgs/userImages/<%= userData.image %>" alt="avatar" class="rounded-circle img-fluid" style="width: 100px; height: 100px;">
                                                                <div class="overlay">
                                                                  <i class="fas fa-pencil-alt"></i>
                                                                </div>
                                                              </div>
<style>.profile-picture-container {
    position: relative;
    display: inline-block;
  }
  
  .overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: end;
    justify-content: end;
    background-color: rgba(255, 255, 255, 0.8); /* Adjust the background color and opacity as needed */
  }
  
  .overlay i {
    margin-bottom: 10px;
    font-size: 24px; /* Adjust the font size as needed */
    color: #a2c310; /* Adjust the color as needed */
  }
  </style>                                                              
                                                                
                                                           
                                                            <input value=" <%= userData.name %>">
                                                           
                                                        </div>
                                                        <button class="btn btn-outline-primary-2 m-4">save</button>
                                                    </div>
                                                </div>


                                                <div class="col-lg-8" style="margin-bottom: 50px;">
                                                    <div class="toggle_info">
                                                        <span><i class="fi-rs-label mr-10"></i><span class="text-muted">want to add a new
                                                                address?</span> <a href="#address1" data-bs-toggle="collapse" class="collapsed"
                                                                aria-expanded="false">Click
                                                                here to enter a new address</a></span>
                                                    </div>
                                                    <div class="panel-collapse collapse coupon_form " id="address1">
                                                        <form action="/addAddress?checkout=true" method="post"
                                                            onsubmit="return validateAddressForm()">
                                                            <div class="mb-4">
                                                                <label for="name" class="form-label">Name</label>
                                                                <input type="text" placeholder="Type here" name="name" class="form-control"
                                                                    id="name">
                                                                <div class="error-message" style="color: red;" id="name-error"></div>
                                                            </div>
                        
                                                            <div class="mb-4">
                                                                <label for="phone" class="form-label">Phone Number</label>
                                                                <input type="text" placeholder="Type here" name="phone" class="form-control"
                                                                    id="phone">
                                                                <div class="error-message" style="color: red;" id="phone-error"></div>
                                                            </div>
                        
                                                            <div class="row gx-3">
                                                                <div class="col-md-6  mb-3">
                                                                    <label for="street" class="form-label">Street</label>
                                                                    <input type="text" placeholder="Type here" name="street"
                                                                        class="form-control" id="street">
                                                                    <div class="error-message" style="color: red;" id="street-error"></div>
                                                                </div>
                        
                                                                <div class="col-md-6  mb-3">
                                                                    <label for="city" class="form-label">City</label>
                                                                    <input type="text" placeholder="Type here" name="city" class="form-control"
                                                                        id="city">
                                                                    <div class="error-message" style="color: red;" id="city-error"></div>
                                                                </div>
                                                            </div>
                        
                                                            <div class="row gx-3">
                                                                <div class="col-md-6  mb-3">
                                                                    <label for="state" class="form-label">State</label>
                                                                    <input type="text" placeholder="Type here" name="state" class="form-control"
                                                                        id="state">
                                                                    <div class="error-message" style="color: red;" id="state-error"></div>
                                                                </div>
                        
                                                                <div class="col-md-6  mb-3">
                                                                    <label for="pincode" class="form-label">Pincode</label>
                                                                    <input type="text" placeholder="Type here" name="pincode"
                                                                        class="form-control" id="pincode">
                                                                    <div class="error-message" style="color: red;" id="pincode-error"></div>
                                                                </div>
                                                            </div>
                        
                                                            <div class="mb-4">
                                                                <label for="houseName" class="form-label">House no./House Name</label>
                                                                <input type="text" placeholder="Type here" name="houseName" class="form-control"
                                                                    id="houseName">
                                                                <div class="error-message" style="color: red;" id="houseName-error"></div>
                                                            </div>
                        
                                                            <div class="mb-4 col-lg-6">
                                                                <label for="addressType" class="form-label">Type</label>
                                                                <input type="text" placeholder="Type here" name="type" class="form-control"
                                                                    id="type">
                                                                <div class="error-message" style="color: red;" id="addressType-error"></div>
                                                            </div>
                        
                                                            <input type="submit" class="btn btn-primary">
                                                        </form>
                                                    </div>
                                                </div>

                                                <div class="mb-25">
                                                    <h4>Edit Address</h4>
                                                </div>
                                                <% if(addresses.length > 0){ %>
                                                <% for (let i=0; i < addresses.length; i++) { %>
                                                    
                                                    <form id="placeOrderForm" action="/placeOrderCodWallet" onclick="window.location.href='/editAddress?userId=<%= userData._id %>&addressId=<%= addresses._id %>'" method="post">
                                                            <div class="mb-10" style="border: 1px solid rgb(125, 115, 115);padding: 10px;">
                                                         
                                                                <label for="<%= addresses[i].name %>">
                                                                    <span></span>
                                                                    <h6><%- addresses[i].type.charAt(0).toUpperCase() +
                                                                            addresses[i].type.slice(1) %> Address<br></h6>
                                                                </label>
                                                                <div class="caption">
                                                                    <p class="card-text">
                                                                        <%= addresses[i].name %>, <%= addresses[i].houseName %>, <%= addresses[i].city %>, <%= addresses[i].pincode %>, <%= addresses[i].state %>, <%= addresses[i].phone %>
                                                                    </p>
                                                                </div>
                                                                <a href="/deleteAddress?userId=<%= userData._id %>&addressId=<%= addresses._id %>">
                                                                    <i class="material-icons md-delete_forever"></i>
                                                                </a>
                                                            </div>
                                                          
                                                        </form>
                                                    <% } %>
                                                    <% } else{ %>
                                                        <span style="color: red;font-size: larger;">Add atleast one address</span>
                                                        <% } %>                                                 
                                           

                                            
                                        </div>

                                    </div>


                                   
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
        </section>
    </main>

    <script>
    document.getElementById('copyCode').addEventListener('click', function() {
        // Get the referral code element
        var referralCodeElement = document.getElementById('referralCode');

        // Create a temporary textarea to hold the text to be copied
        var tempTextarea = document.createElement('textarea');
        tempTextarea.value = referralCodeElement.innerText;

        // Append the textarea to the document
        document.body.appendChild(tempTextarea);

        // Select and copy the text
        tempTextarea.select();
        document.execCommand('copy');

        // Remove the temporary textarea
        document.body.removeChild(tempTextarea);

        // Show SweetAlert
        Swal.fire({
            icon: 'success',
            title: 'Copied!',
            text: 'Referral code has been copied to clipboard.',
            timer: 2000, // Set the duration of the alert (in milliseconds)
            timerProgressBar: true,
            showConfirmButton: false
        });
    });
</script>

    <script>
        function confirmDelete(userId) {
            var result = confirm("Are you sure you want to delete this account?");

            if (result) {
                window.location.href = "/admin/deleteAccount?id=" + userId;
            }
        }

    </script>





<%- include('../layouts/footer.ejs') %>